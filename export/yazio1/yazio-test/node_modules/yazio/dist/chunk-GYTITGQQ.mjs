import{b as l,c as e}from"./chunk-IPN6EH6Z.mjs";var s=e.object({token_type:e.string(),access_token:e.string(),refresh_token:e.string(),expires_in:e.number(),expires_at:e.number()}),c=e.union([s,e.function().returns(e.union([s,e.promise(e.union([s,e.null()])),e.null()]))]),r=e.object({username:e.string(),password:e.string()}),u=e.union([r,e.promise(r),e.function().returns(e.union([r,e.promise(e.union([r,e.null()])),e.null()])),e.promise(r)]),a=e.function().args(e.object({token:s})).returns(e.any()),f=e.union([e.object({credentials:u,token:e.undefined(),onRefresh:a.optional()}),e.object({credentials:e.undefined(),token:c,onRefresh:a.optional()}),e.object({credentials:u,token:c,onRefresh:a.optional()})]);var h=async n=>{if(typeof n=="function"){let t=n();return t instanceof Promise?await t:t}else return n instanceof Promise?await n:n||null},d=async n=>{if(typeof n=="function"){let t=n();return t instanceof Promise?await t:t}else return n instanceof Promise?await n:n||null},p=class{token=null;credentials=null;cachedToken=null;onRefresh=null;authenticate=async()=>{if(this.cachedToken&&this.cachedToken.expires_at>Date.now())return this.cachedToken;let t=await d(this.token);if(t&&t.expires_at>Date.now())return this.cachedToken=t,t;let o=await h(this.credentials);if(!o)throw new Error("Unable to resolve credentials. Please make sure `credentials` is passed correctly.");let i=await l(o);return this.token=i,this.onRefresh&&this.onRefresh({token:i}),i};constructor(t){let o=f.safeParse(t);if(!o.success)throw new Error("Could not parse given YazioAuthInit object. Please make sure it is in the correct format.");o.data.token&&(this.token=o.data.token),o.data.credentials&&(this.credentials=o.data.credentials),o.data.onRefresh&&(this.onRefresh=o.data.onRefresh)}};export{p as a};
